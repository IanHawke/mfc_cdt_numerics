<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Numerical Methods for MFC CDT - 5&nbsp; Time evolution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./finite_elements_4.html" rel="next">
<link href="./fe_2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./fe_1.html">Finite Elements</a></li><li class="breadcrumb-item"><a href="./finite_elements_3.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Time evolution</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Numerical Methods for MFC CDT</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Numerical-Methods-for-MFC-CDT.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Numerical-Methods-for-MFC-CDT.docx">
              <i class="bi bi-bi-file-word pe-1"></i>
            Download Docx
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Numerical-Methods-for-MFC-CDT.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fd_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Climate models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Spectral</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spectral methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Finite Elements</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fe_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Finite Elements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fe_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Two dimensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./finite_elements_3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Time evolution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./finite_elements_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Flexibility with efficiency</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Background material</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_order.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Order of accuracy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_lax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Lax Equivalence Theorem</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#weak-form" id="toc-weak-form" class="nav-link active" data-scroll-target="#weak-form"><span class="header-section-number">5.1</span> Weak form</a></li>
  <li><a href="#time-stepping" id="toc-time-stepping" class="nav-link" data-scroll-target="#time-stepping"><span class="header-section-number">5.2</span> Time stepping</a>
  <ul class="collapse">
  <li><a href="#euler" id="toc-euler" class="nav-link" data-scroll-target="#euler"><span class="header-section-number">5.2.1</span> Euler</a></li>
  <li><a href="#rk2" id="toc-rk2" class="nav-link" data-scroll-target="#rk2"><span class="header-section-number">5.2.2</span> RK2</a></li>
  </ul></li>
  <li><a href="#evolving-to-steady-state" id="toc-evolving-to-steady-state" class="nav-link" data-scroll-target="#evolving-to-steady-state"><span class="header-section-number">5.3</span> Evolving to steady state</a></li>
  <li><a href="#advection-dominated-flow" id="toc-advection-dominated-flow" class="nav-link" data-scroll-target="#advection-dominated-flow"><span class="header-section-number">5.4</span> Advection dominated flow</a></li>
  <li><a href="#matrix-structure" id="toc-matrix-structure" class="nav-link" data-scroll-target="#matrix-structure"><span class="header-section-number">5.5</span> Matrix structure</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./fe_1.html">Finite Elements</a></li><li class="breadcrumb-item"><a href="./finite_elements_3.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Time evolution</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-fe3" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Time evolution</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We now want to solve the full time dependent problem, (<a href="fd_1.html#eq-fd1-advection-sources" class="quarto-xref">Equation&nbsp;<span>1.4</span></a>),</p>
<p><span id="eq-fe3-advection-sources"><span class="math display">\[
\frac{D \Psi}{D t} = \frac{\partial \Psi}{\partial t} + \mathbf{u} \cdot \nabla \Psi = S + \mu_{\Psi}\nabla^2 \Psi.
\tag{5.1}\]</span></span></p>
<p>Again we will start by restricting to one dimension, giving</p>
<p><span id="eq-fe3-1d-adv-diff"><span class="math display">\[
\frac{D \Psi}{D t} = \underbrace{\frac{\partial \Psi}{\partial t}}_{\text{(1)}} + \underbrace{u \frac{\partial \Psi}{\partial x}}_{\text{(2)}} = \underbrace{S}_{\text{(3)}} + \underbrace{\mu_{\Psi} \frac{\partial^2 \Psi}{\partial x^2}}_{\text{(4)}} .
\tag{5.2}\]</span></span></p>
<p>We remember that the respective terms are</p>
<ol type="1">
<li>the time evolution of the pollution concentration,</li>
<li>the advection of the pollution concentration by the wind,</li>
<li>the source/sink of pollution,</li>
<li>the diffusion of pollution concentration.</li>
</ol>
<p>We will again use the domain <span class="math inline">\(x \in [0, 1]\)</span> with the boundary conditions</p>
<p><span id="eq-fe3-bcs"><span class="math display">\[
\Psi(0) = \alpha, \quad \partial_x \Psi |_{x=1} = \beta .
\tag{5.3}\]</span></span></p>
<section id="weak-form" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="weak-form"><span class="header-section-number">5.1</span> Weak form</h2>
<p>We will repeat the key steps from the static case: introducing the weak form by multiplying by a test function and integrating over the domain, and representing all functions in terms of shape, or basis, functions. The key difference now is that the functions depend on time.</p>
<p>The continuum weak form of (<a href="#eq-fe3-1d-adv-diff" class="quarto-xref">Equation&nbsp;<span>5.2</span></a>) is</p>
<p><span id="eq-fe3-1d-adv-diff-weak"><span class="math display">\[
\begin{split}
\underbrace{\int w \frac{\partial \Psi}{\partial t}}_{\text{(1)}} + \underbrace{u w(1) \Psi(1)}_{\text{(2a)}} - \underbrace{u \int \Psi \frac{\partial w}{\partial x}}_{\text{(2b)}} = \underbrace{\int w S}_{\text{(3)}} + \\ \underbrace{\mu_{\Psi} w(1) \beta}_{\text{(4a)}} - \underbrace{\mu_{\Psi} \int \frac{\partial w}{\partial x} \frac{\partial \Psi}{\partial x}}_{\text{(4b)}} .
\end{split}
\tag{5.4}\]</span></span></p>
<p>Note that we have used that the weighting function vanishes at the Dirichlet boundary, <span class="math inline">\(w(0) = 0\)</span>, and assumed that the test function <span class="math inline">\(w\)</span> is time independent. We have integrated by parts again to move derivatives onto the test function, with the notation linking the boundary terms to their associated integrals.</p>
<p>To include time dependence we take the static case of (<a href="fe_1.html#eq-fe1-shape1" class="quarto-xref">Equation&nbsp;<span>3.8</span></a>), which was</p>
<p><span id="eq-fe3-shape"><span class="math display">\[
\Psi(x) = \sum_A \Psi_A N_A(x),
\tag{5.5}\]</span></span></p>
<p>and generalise it so that <span class="math inline">\(\Psi_A \equiv \Psi_A(t)\)</span>. Now the nodal values <span class="math inline">\(\Psi_A\)</span> contain the time dependence. The shape functions <span class="math inline">\(N_A\)</span> remain time independent.</p>
<p>The weak form will now give us</p>
<p><span id="eq-fe3-1d-adv-diff-weak-discrete1"><span class="math display">\[
\begin{aligned}
\text{(1)} &amp; \to \sum_B w_B \sum_A \frac{\partial \Psi_A}{\partial_t}  \int N_A N_B, \\
\text{(2a)} &amp; \to u w(1) \Psi(1) , \\
\text{(2b)} &amp; \to -u \sum_B w_B \sum_A \Psi_A \int N_A \frac{\partial N_B}{\partial x}, \\
\text{(3)} &amp; \to \sum_B w_B \int N_B S, \\
\text{(4a)} &amp; \to \mu_{\Psi} w(1) \beta, \\
\text{(4b)} &amp; \to  - \mu_{\Psi} \sum_B w_B \sum_A \Psi_A \int \frac{\partial N_A}{\partial x} \frac{\partial N_B}{\partial x}  .
\end{aligned}
\tag{5.6}\]</span></span></p>
<p>As before, we gather together all of the terms with respect to the (<em>arbitrary</em>) coefficients of the test function <span class="math inline">\(w_B\)</span>. We also introduce the function <span class="math inline">\(q(x) = \alpha N_0(x)\)</span> and write <span class="math inline">\(\Psi(x, t) = \psi(x, t) + q(x)\)</span>, to balance the Dirichlet boundary condition. This gives the matrix equation</p>
<p><span id="eq-fe3-1d-adv-diff-weak-discrete-full"><span class="math display">\[
M_{AB} \frac{\partial \psi_A}{\partial t} + K_{AB} \psi_A = F_B,
\tag{5.7}\]</span></span></p>
<p>where <span class="math inline">\(M\)</span> is the <em>mass</em> or <em>capacity</em> matrix, and <span class="math inline">\(K\)</span> is the stiffness matrix and <span class="math inline">\(\mathbf{F}\)</span> the force vector as before. We read off the coefficients of the various terms using (<a href="#eq-fe3-1d-adv-diff-weak-discrete1" class="quarto-xref">Equation&nbsp;<span>5.6</span></a>) as</p>
<p><span id="eq-fe3-1d-adv-diff-weak-discrete-local"><span class="math display">\[
\begin{aligned}
M_{ab} &amp;= \int N_a N_b, \\
K_{ab} &amp;= \mu_{\Psi} \int \frac{\partial N_a}{\partial x} \frac{\partial N_b}{\partial x} - u \int N_a  \frac{\partial N_b}{\partial x}, \\
F_b &amp;= \int N_b S - u \Psi_0 \delta^0_{B(b)} + \mu_{\Psi} \delta_{B(b)}^{N_\text{elements}} - q \delta^0_{B(b)} k^0_{12} .
\end{aligned}
\tag{5.8}\]</span></span></p>
<p>The terms are given with respect to the <em>local</em> element number <span class="math inline">\(\{a, b\}\)</span> and are assembled into the <em>global</em> matrix in exactly the same way as before. The notation <span class="math inline">\(B(b)\)</span> indicates the global node number computed from the local number, and is needed to identify the boundary locations.</p>
</section>
<section id="time-stepping" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="time-stepping"><span class="header-section-number">5.2</span> Time stepping</h2>
<p>The matrix equation (<a href="#eq-fe3-1d-adv-diff-weak-discrete-full" class="quarto-xref">Equation&nbsp;<span>5.7</span></a>) solves for <span class="math inline">\(\psi\)</span> via evolving its nodal values <span class="math inline">\(\psi_A\)</span> in time. This equation is <em>semi-discrete</em>: it is continuous in time, but discrete in space.</p>
<p>Semi-discrete approaches to PDEs are more general than finite element methods. They have the huge advantage that we end up solving ODEs, for which there is a vast literature, considerable analysis, and many well implemented and tested codes. They have the disadvantage that they are typically less efficient than bespoke, fully discrete methods with the same order of accuracy.</p>
<p>Here we give two simple methods that are often used in solving the time evolution of a semi-discrete problem. We write the system to be solved as</p>
<p><span id="eq-fe3-semi_discrete1"><span class="math display">\[
\frac{\partial \mathbf{U}}{\partial t} = \symbf{\mathcal{F}} (\mathbf{U})
\tag{5.9}\]</span></span></p>
<p>where <span class="math inline">\(\mathbf{U}\)</span> is the <em>state vector</em>. In the case of (<a href="#eq-fe3-1d-adv-diff-weak-discrete-full" class="quarto-xref">Equation&nbsp;<span>5.7</span></a>) the state vector is the coefficients <span class="math inline">\(\psi_A\)</span> and the <em>right-hand-side vector</em> <span class="math inline">\(\symbf{\mathcal{F}}\)</span> is</p>
<p><span id="eq-fe3-semi_discrete1"><span class="math display">\[
\mathcal{F}_A = M^{-1}_{AB} \left( F_B - K_{AB} \psi_A \right).
\tag{5.10}\]</span></span></p>
<p>Note that explicitly computing the matrix inverse is typically numerically inaccurate, and instead solving the linear system is preferred.</p>
<section id="euler" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="euler"><span class="header-section-number">5.2.1</span> Euler</h3>
<p>We denote the (known) state vector at time <span class="math inline">\(t^{(n)}\)</span> and <span class="math inline">\(\mathbf{U}^n\)</span>. In Euler’s method we update to the unknown time <span class="math inline">\(t^{(n+1)} = t^{(n)} + \Delta t\)</span> by</p>
<p><span id="eq-fe3-euler"><span class="math display">\[
\mathbf{U}^{n+1} = \mathbf{U}^n + \Delta t \, \symbf{\mathcal{F}} \left( \mathbf{U}^n \right).
\tag{5.11}\]</span></span></p>
<p>This is exactly the result given by forward differencing in time, as seen (for example) in the derivation of FTCS. It is explicit, and gives first order accuracy in time.</p>
</section>
<section id="rk2" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="rk2"><span class="header-section-number">5.2.2</span> RK2</h3>
<p>Higher order methods can be constructed by updating in multiple <em>stages</em>. At each stage we compute the right hand side vector, and from that can approximate a solution at a time typically in <span class="math inline">\([t^{(n)}, t^{(n+1)}]\)</span>. By combining these stages appropriately a better approximation to the solution at the next timestep can be found. The <em>Runge-Kutta</em> family of methods is typical for this approach.</p>
<p>One particular subset of Runge-Kutta methods can ensure a form of total variation boundedness, linked to the TVD methods seen earlier. These <em>Strict Stability Preserving</em> (SSP) methods are preferred when dealing with semi-discrete PDE evolutions. The standard second order, explicit, SSP Runge-Kutta method (ESSPRK2) can be written</p>
<p><span id="eq-fe3-rk2"><span class="math display">\[
\begin{aligned}
\mathbf{U}^{[1]} &amp;= \mathbf{U}^{n} + \Delta t \,  \symbf{\mathcal{F}} \left( \mathbf{U}^n \right), \\
\mathbf{U}^{n+1} &amp;= \tfrac{1}{2} \left\{ \mathbf{U}^{n} +  \mathbf{U}^{[1]} + \Delta t \, \symbf{\mathcal{F}} \left( \mathbf{U}^{[1]} \right) \right\} .
\end{aligned}
\tag{5.12}\]</span></span></p>
</section>
</section>
<section id="evolving-to-steady-state" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="evolving-to-steady-state"><span class="header-section-number">5.3</span> Evolving to steady state</h2>
<p>Let us take the simplified problem from (<a href="fe_1.html" class="quarto-xref"><span>Chapter 3</span></a>), where</p>
<p><span id="eq-fe3-source1"><span class="math display">\[
S = 1 - x, \quad \mu = 1.
\tag{5.13}\]</span></span></p>
<p>We know the steady state solution is <span class="math inline">\(x (x^2 - 3 x + 3) / 6\)</span>. However, we can start from the solution <span class="math inline">\(x = 0\)</span> and see how it evolves towards steady state. For this we will use Euler timestepping.</p>
<div id="cell-fig-fe3-adv-diff-time-steady" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div id="fig-fe3-adv-diff-time-steady" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe3-adv-diff-time-steady-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="finite_elements_3_files/figure-html/fig-fe3-adv-diff-time-steady-output-1.png" width="608" height="429" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe3-adv-diff-time-steady-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Evolving to the steady state solution to the advection diffusion equation with source <span class="math inline">\(S = 1 - x\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="advection-dominated-flow" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="advection-dominated-flow"><span class="header-section-number">5.4</span> Advection dominated flow</h2>
<p>Let us now look at the advection problem from setting <span class="math inline">\(S(x) = 0 = \mu_\Psi\)</span>. The advection equation results and we have, from (<a href="#eq-fe3-1d-adv-diff-weak-discrete-local" class="quarto-xref">Equation&nbsp;<span>5.8</span></a>) that</p>
<p><span id="eq-fe3-adv_dominated_1"><span class="math display">\[
\begin{aligned}
M_{ab} &amp;= \int N_a N_b, \\
K_{ab} &amp;= - u \int N_a  \frac{\partial N_b}{\partial x}, \\
F_b &amp;= - u \Psi_0 \delta^0_{B(b)} - q \delta^0_{B(b)} k^0_{12} .
\end{aligned}
\tag{5.14}\]</span></span></p>
<p>The results are seen in (<a href="#fig-fe3-adv-diff-time-advection" class="quarto-xref">Figure&nbsp;<span>5.2</span></a>) where the expected advective behaviour is seen. Note that the boundary conditions are built into the scheme here, through their appearance in the force vector. Changing boundary conditions will require modifying the scheme.</p>
<div id="cell-fig-fe3-adv-diff-time-advection" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div id="fig-fe3-adv-diff-time-advection" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe3-adv-diff-time-advection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="finite_elements_3_files/figure-html/fig-fe3-adv-diff-time-advection-output-1.png" width="598" height="430" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe3-adv-diff-time-advection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: Advection of a sine wave. Note the standard boundary conditions (Dirichlet on the left, Neumann on the right) means the pulse leaves the domain.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="matrix-structure" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="matrix-structure"><span class="header-section-number">5.5</span> Matrix structure</h2>
<p>The properties of the finite element method is closely tied to the properties of the matrices involved.</p>
<div id="cell-fig-fe3-matrix-structure" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div id="fig-fe3-matrix-structure" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe3-matrix-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="finite_elements_3_files/figure-html/fig-fe3-matrix-structure-output-1.png" width="662" height="334" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe3-matrix-structure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3: The structure of the mass (left) and stiffness (right) matrices for the advection diffusion problem with <span class="math inline">\(u=1, \mu=0.1\)</span>. The symmetry and sparsity can both be used theoretically and practically.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In (<a href="#fig-fe3-matrix-structure" class="quarto-xref">Figure&nbsp;<span>5.3</span></a>) we see the structure of the mass and stiffness matrices for the one dimensional advection-diffusion problem. The matrices are symmetric and sparse - in this case they are tridiagonal. In higher dimensions, or with more complex boundary conditions, or with more complex systems of equations, the matrices become messier. However, the key point of matrix sparsity will be retained.</p>
<p>The symmetry of the mass matrix is useful in proving invertibility (essential for the method to work). The symmetry of the stiffness matrix is useful for constructing the eigenvalues of the discrete system, which are linked to the amplification rates in a von Neumann stability analysis.</p>
<p>The sparsity of the matrices is crucial in implementing a method that scales to large numbers of elements. In the simplest one dimensional implementation the size of the matrices scales as <span class="math inline">\(N_{\text{elements}}^2\)</span>. However, the tridiagonal nature means that the amount of <em>useful</em> (non-zero) information scales as <span class="math inline">\(N_{\text{elements}}\)</span>. The computational memory and work saved is substantial even with only tens of elements. In higher dimensions with large domains (millions of elements) the construction of the full matrix is impractical.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./fe_2.html" class="pagination-link" aria-label="Two dimensions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Two dimensions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./finite_elements_4.html" class="pagination-link" aria-label="Flexibility with efficiency">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Flexibility with efficiency</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>